version: '3.4'
services:
  elasticsearch-1:
    image: 'docker.elastic.co/elasticsearch/elasticsearch:7.17.1'
    container_name: elasticsearch-1
    ports:
      - '9200:9200'
      - '9300:9300'
    environment:
    - "discovery.type=single-node"
  kibana:
    image: 'docker.elastic.co/kibana/kibana:7.17.1'
    # network_mode: host
    container_name: kibana
    environment:
      - 'ELASTICSEARCH_HOSTS=http://elasticsearch-1:9200'
    depends_on:
      - elasticsearch-1
    ports:
      - '5601:5601'
#  metricbeat:
#    image: 'docker.elastic.co/beats/metricbeat:7.17.1'
#    container_name: metricbeat
#    depends_on:
#      - kibana
#    environment:
#      - ELASTICSEARCH_USERNAME=elastic
#      - ELASTICSEARCH_PASSWORD=changeme
#    volumes:
#      - ./metricbeat.docker.yml:/usr/share/metricbeat/metricbeat.yml:ro
#      - /var/run/docker.sock:/var/run/docker.sock:ro
#      - /sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro
#      - /proc:/hostfs/proc:ro
#      - /:/hostfs:ro
#    command: metricbeat -e -strict.perms=false
#  filebeat:
#    # network_mode: "host"
#    image: docker.elastic.co/beats/filebeat:7.16.3
#    depends_on:
#      - kibana
#    container_name: filebeat
#    # user: root
#    volumes:
#      - ./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml
#      - ./nginx-logs:/var/logs/nginx:Z
#  nginx:
#    image: nginx:1.21.4
#    ports:
#    - "80:80"
#    volumes:
#      - ./nginx-logs:/var/log/nginx:Z
#      - ./nginx.conf:/etc/nginx/nginx.conf:ro
#      - ./default.conf:/etc/nginx/conf.d/default.conf:ro
#    command: [ "nginx", "-g", "daemon off;" ]
